\documentclass[11pt]{article}

\usepackage[margin=1in]{geometry}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{xcolor}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage[]{hyperref}
\hypersetup{
  colorlinks=false,
}
\usepackage{cleveref}
% \usepackage[disable]{todonotes}
\usepackage{todonotes}

\usepackage{biblatex}
\addbibresource{library.bib}

\newtheorem{property}{Property}
\newtheorem{definition}{Definition}
\newtheorem{claim}{Claim}
\newtheorem{rrule}{Rule}
\newtheorem{thm}{Theorem}

% \title{Consensus with Permissionless Quorums in the Stellar Network}
% A reference to Cachin's paper:
\title{Asymmetric Distributed Trust in a Permissionless System}
\date{\today}
\author{Giuliano Losa\\giuliano@galois.com}

\begin{document}

\maketitle

\abstract{
Fail-prone systems capture assumptions about which processes may fail together during an execution of a distributed system.
To every fail-prone system corresponds a canonical quorum system that can solve tasks such as read-write registers and consensus despite failures that remain within the assumptions.
However, in a permissionless network, it is difficult to agree on failure assumptions or quorums a priori.
In practice, the Stellar Network solves this problem by allowing participants to form their own, personal notion of what a quorum is.
However, the relationship between Stellar's model and traditional quorum systems is not well-understood.
In this paper we cast new light on the Stellar model by showing that, similarly to traditional quorum systems, Stellar's Federated Byzantine Quorum Systems correspond to assumptions about failures that are formalized using a new form of fail-prone system.
}

\newpage

\section{Introduction}

% \todo[inline]{The notion of federeated quorum system does not make sense. If process $p_i$ only trusts $P_i$, then why would it pick quorum members outside $P_i$? We could change the story and only focus on canonical quorum systems. Or maybe it can be understood as follows: a process ``hears'' by gossip from a set of nodes and then picks a quorum among the nodes it heard from; so the conditionn would be: for every slice choice ... , for every two quorums insider ... , ... }

% Following Cachin and Tackmann, we define an asymmetric fail-prone system $\mathbb{F}=\left[\mathcal{F}_1,...,\mathcal{F}_n\right]$ as a family of fail-prone systems, where the fail-prone system $\mathcal{F}_i$ is a set of sets of processes that denote the trust assumptions of process $p_i$. However, we interpret the assumption encoded by a fail-prone system differently from Cachin and Tackmann.

A common problem in a distributed system is to solve a task (e.g.\ consensus) given some assumption about the possible failures that may occur.
Let us consider possible failures described by a fail-prone system~\cite{malkhiByzantineQuorumSystems1998}, also called adversary structure~\cite{hirtPlayerSimulationGeneral2000}.
A fail-prone system $\mathcal{F}=\left\{F_1,...,F_n\right\}$ is a set of fail-prone sets, where, for every $i$, the fail-prone set $F_i$ is a subset of processes.
$\mathcal{F}$ denotes the assumption that, in a given execution, the set of processes that actually fail is a subset of one of the fail-prone sets; we call such an execution a fail-compatible execution.

In the rest of the paper, we consider Byzantine failures, where a process that fails can behave arbitrarily; this models the worst-case scenario in which the failed processes are under control of an adversary which tries to disrupt the system.

To devise an algorithm that tolerates the failures described by a fail-prone system, one usually uses a quorum system for $\mathcal{F}$.
A quorum system for $\mathcal{F}$ is a set of quorums, which are sets of processes, such that: (a) the intersection of two quorums is not a subset of a fail-prone set and (b) for every fail-prone set $F$, there is a quorum disjoint from $F$.
This guarantees two crucial properties:
\begin{itemize}
  \item[Consistency] In every fail-compatible execution, every two quorums have a non-faulty member in common.
  \item[Availability] In every fail-compatible execution, there is at least one quorum that is exclusively non-faulty.
\end{itemize}
Given the Consistency and Availability properties, there are well-known algorithms for solving tasks such as read-write registers or consensus.

Given a fail-prone system $\mathcal{F}$, Hirt and Maurer~\cite{hirtPlayerSimulationGeneral2000} show that, if no three fail-prone sets of $\mathcal{F}$ cover the whole system, called Property $Q^3(\mathcal{F})$, then there exists a canonical quorum system $\overline{\mathcal{F}}$ for $\mathcal{F}$.
$\overline{\mathcal{F}}$ is defined such that a set $Q$ is a quorum of $\overline{\mathcal{F}}$ whenever $Q$ is the complement of a fail-prone set\footnote{Hirt and Maurer also show that if $Q^3(\mathcal{F})$ does not hold, then there exists no quorum system for $\mathcal{F}$.}.
Thus, given assumptions about failures formalized in a fail-prone system $\mathcal{F}$ satisfying $Q^3\left(\mathcal{F}\right)$, $\overline{\mathcal{F}}$ is a natural quorum system to use to solve tasks such as consensus.
For example, consider a fail-prone system $\mathcal{F}_4$ consisting of 4 process where every singleton set is a fail-prone set (i.e.\ in every execution, at most one process fails).
By definition, the quorums of the canonical quorum system for $\mathcal{F}_4$ are all the sets of processes of cardinality 3.

One issue with the notion of fail-prone system is that it is not very useful in permissionless systems.
In a permissionless system, processes do not generally know what the set of participants is, and each process has a potentially different, partial view of the system.
Thus, it does not make sense for processes to (a) make assumptions about the entire system and (b) all make the same assumptions.
For example, in a permissionless system, a fail-prone system where processes assume that at most some threshold $t$ (e.g.\ 1/3) of the system will fail does not yield a useful canonical quorum system: a quorum is supposed to be a set of more than $n$ times $t$ processes, where $n$ is the total number of processes, but there is no way to reliably know $n$.

In this paper, we make the following contributions:
\begin{enumerate}
  \item
    We propose the new notion of \emph{federated fail-prone systems} which generalizes fail-prone systems and which is adapted to the permissionless setting.
    In contrast with fail-prone systems, where all processes make the same failure assumptions about the entire system, in a federated fail-prone system, each process (a) makes its own, personal failures assumptions and (b) makes failure assumptions only about a subset of the system.
  \item
    We define property $Q^3$ of federated fail-prone systems, and we show that given a federated fail-prone system $\mathcal{F}$ that satisfies $Q^3$, there is a canonical quorum system $\overline{\mathcal{F}}$ that satisfies the Availability and Consistency properties; moreover, we show that $\overline{\mathcal{F}}$ is none other than a Federated Byzantine Quorum System as defined by Mazi√®res~\cite{MazieresStellarConsensusProtocol2015} and used in the Stellar Network.
\end{enumerate}

% With the notion of federated fail-prone system in hand, we present a generalization of property $Q^3$ and we show that, given a federated fail-prone system $\mathbb{F}$ satisfying $Q^3(\mathbb{F})$, there is a canonical quorum system for $\mathbb{F}$ which satisfies the Consistency and Availability properties.

% In~\Cref{sec:basic}, we present a basic notion of Federated Fail-Prone System which eschews some important considerations (dealt with in~\Cref{sec:lying,sec:subjective}) but captures this main idea.

% Next,~\Cref{sec:lying} extends the basic notion of Federated Fail-Prone Systems to account for the fact that processes that fail may lie and equivocate about their own configuration. Finally,~\Cref{sec:subjective} further extends the model to capture networks consisting of several, disjoint subsets that maintain consistency internally but diverge from each other.

% In a fail-prone system, every process makes the same assumption about failures.
% This is problem
% A limitation of fail-prone systems is that they are hardly a useful model in permissionless networks.

% A limitation of fail-prone systems is that they presupposes an existing agreement on who participates and what constitutes a fail-prone set.
% This is difficult to achieve in an open, permissionless network, where arbitrary processors can join or leave without synchronization.

% Some permissionless blockchains solve this problem using Proof-of-Stake.
% Roughly speaking, a Proof-of-Stake system relies on a pre-existing agreement on who owns how much of a certain resource, such as cryptocurrency, and defines a quorum as a set that collectively owns more than some threshold, e.g.\ two thirds, of the total amount of resources available; in terms of fail-prone system, this amounts to assuming that the fail-prone sets are the sets that collectively own less than one third of the total amount of resources.

% Another idea is to let processes pick their own quorums for themselves. In a setting where processes have public, recognizable identities, one might hope that there is enough agreement in the real-world on some reputation-like quantity so that, if processes pick peers they deem reputable to create their quorums, the resulting quorums will be sufficiently overlapping and non-faulty. This leads to the idea of asymmetric fail-prone systems, as studied by Cachin and Tackmann~\cite{cachinAsymmetricDistributedTrust2019}.

% In Cachin and Tackmann's asymmetric fail-prone systems, each process makes its own assumptions about which processes may fail together.
% An asymmetric fail-prone system is an array of fail-prone systems $\mathbb{F}=\left[\mathcal{F}_1,...,\mathcal{F}_n\right]$ where $\mathcal{F}_i$ is a fail-prone system denoting the assumptions of process $p_i$.  Similarly to Hirt and Maurer, Cachin and Tackman define the notion of asymmetric quorum system for $\mathbb{F}$, they generalize property $Q^3$ to asymmetric quorum systems, and they show that (a) $Q^3(\mathbb{F})$ holds if and only if there exists an asymmetric quorum system for $\mathbb{F}$ and (b) an asymmetric fail-prone system determines a canonical asymmetric quorum system for $\mathbb{F}$.

% The property $Q^3(\mathbb{F})$ of Cachin and Tackmann stipulates that for every two processes $p_i$ and $p_j$, for every two fail-prone sets $F_i^1$ and $F_i^2$ of $p_i$, for every two fail-prone sets $F_j^1$ and $F_j^2$ of $p_j$, we must have $\mathcal{P}\not\subseteq F_i^1\cup F_j^1\cup \left(F_i^2\cap F_j^2\right)$. Thus, unless every two processes in the system make compatible assumptions, in the sense of satisfying property $Q^3(\mathbb{F})$, it is not possible to obtain an asymmetric quorum system that tolerates failures within the bounds of the failure assumptions made by the processes. In practice, it is unclear to us whether there exists a pragmatic scheme to achieve Cachin and Tackmann's property $Q^3(\mathbb{F})$ in a permissionless network.

% The Stellar Network~\cite{MazieresStellarConsensusProtocol2015,lokhavaFastSecureGlobal2019} offers a practical solution to the problem of creating a quorum system in a permissionless network.
% On the surface, Stellar's quorum systems, called Federated Byzantine Quorum Systems (FBQS for short), seem similar to asymmetric quorum systems.
% Indeed, each process in a Federated Byzantine Quorum System has its own notion of what a quorum is.
% However, processes in a FBQS do not choose their quorums directly; instead, they choose sets called \emph{quorum slices} and a process $p$ in a FBQS recognizes a set $Q$ as a quorum whenever (a) $p$ has a slice that is a subset of $Q$ and (b) every member of $Q$ has a slice that is a subset of $Q$.

% As Cachin and Tackmann observe, asymmetric quorum systems do not capture Stellar's Federated Byzantine Quorum Systems, and the question of the precise characterization of Stellar's Federated Byzantine Quorum Systems in terms of assumptions about failures remained open.

% Our main contribution is to show that, similarly to classic and asymmetric quorum systems, a Federated Byzantine Quorum System can be understood in terms of a fail-prone system.

% In contrast with asymmetric quorum systems, where processes make failure assumptions about the entire system, in a federated fail-prone system, processes make failure assumptions only about a subset of the system.
% This is key in a permissionless system, where processes do not know exactly what the entire system consists of.
% In~\Cref{sec:basic}, we present a basic notion of Federated Fail-Prone System which eschews some important considerations (dealt with in~\Cref{sec:lying,sec:subjective}) but captures this main idea.

% With the notion of Federated Fail-Prone System in hand, we parallel Hirt and Maurer: we present the notion of Federated Quorum System for a Federated Fail-Prone System and we define a new property $Q^3$ and show that there exists a Federated Quorum System for a Federated Fail-Prone System $\mathbb{F}$ if and only if $Q^3(\mathbb{F})$ holds. Moreover, given a Federated Fail-Prone System $\mathbb{F}$ satisfying $Q^3(\mathbb{F})$, we show that there is a canonical Federated Quorum System for $\mathbb{F}$.

% Next,~\Cref{sec:lying} extends the basic notion of Federated Fail-Prone Systems to account for the fact that processes that fail may lie and equivocate about their own configuration. Finally,~\Cref{sec:subjective} further extends the model to capture networks consisting of several, disjoint subsets that maintain consistency internally but diverge from each other.

\section{Federated Fail-Prone Systems}
\label{sec:basic}

We consider a set of processes $\mathcal{P}$ where individual processes do not know what $\mathcal{P}$ is exactly.
Instead, each process $p_i$ trusts a subset $P_i$ of the participants to present accurate information about the rest of the system.
However, $p_i$ trusts members of $P_i$ only to the extent that they do not fail, and $p_i$ makes assumptions about those failures using a fail-prone system $\mathcal{F}_i$ over $P_i$ (i.e.\ $\mathcal{F}_i\subseteq 2^{P_i}$).

We capture the setting described above with the notion of federated fail-prone system. A federated fail-prone system is an array $\mathbb{F}=\left[\left(P_1,\mathcal{F}_1\right),...,\left(P_n,\mathcal{F}_n\right)\right]$ that associates to each process $p_i$ a set of trusted peers $P_i$ and a fail-prone system $\mathcal{F}_i$ over $P_i$.
We now consider a fixed such $\mathbb{F}$.

Next we define what it means for a subset $P$ of the processes to make correct assumptions about failures.
The assumptions of the processes in a set $P$ are satisfied in an execution if and only if the set of processes that actually fail is a set $A$ such that, for every process $p_i$ in $P$ that does not fail (i.e.\ $p_i\not\in A$), there exists $F\in\mathcal{F}_i$ such that $P_i\cap A \subseteq F$.
We say that such an execution is a $P$-fail-compatible execution, and that such a set $A$ is $P$-fail-compatible.
% {\color{red}(here we could make things relative to a subset of the processes.)}

Note that two processes $p_i$ and $p_j$ may have disjoint trusted sets, i.e.\ it is well possible that $P_i\cap P_j=\emptyset$.
This may seem to be an insurmountable problem in e.g.\ a consensus algorithm: how are processes supposed to remain in agreement despite not having any peer in common? Informally, the answer is that two processes that have disjoint trusted sets can nevertheless stay in agreement when they can always transitively hear from a common third process despite failures; this is formalized precisely in property $Q^3(\mathbb{F})$ of federated fail-prone systems (defined below).

We now proceed with a few definitions necessary for the rest of the paper.
Given a process $p_i$ and $F\in \mathcal{F}_i$, we say that the set $P_i\setminus F$ is a slice of $p_i$.
Define a slice choice $\mathcal{S}$ as an array $\left[S_1,...,S_n\right]$ of slices, where, for every $i$, $S_i$ is a slice of $p_i$.
Define a slice-choice graph $G$ as a directed graph whose nodes are processes and such that there exists a slice choice $\left[S_1,...,S_n\right]$ such that, for every $p_i$ and $p_j$, there is an edge from $p_i$ to $p_j$ whenever $p_j\in S_i$. Note that a slice-choice array determines a slice-choice graph and vice versa.
Given a slice choice $\mathcal{S}=\left[S_1,...,S_n\right]$ and a set of processes $P$, we say that $P$ is closed under $\mathcal{S}$ if, for every $p_i$ in $P$, $S_i$ is a subset of $P$.

% To sum up, a federated fail-prone system as a family of fail-prone systems $\mathbb{F}=\left\{\left(P_1,\mathcal{F}_1\right),...,\left(P_n,\mathcal{F}_n\right)\right\}$ where $P_i$ is the set of processes that $p_i$ knows of and $\mathcal{F}_i$ is a fail-prone system over $P_i$ that denotes the assumptions that $p_i$ makes about the possible failures of members of $P_i$.

% Note that two processes $p_i$ and $p_j$ may not even know of a common third process, i.e.\ it is well possible that $P_i\cap P_j=\emptyset$.
% As should become apparent in definition of Property $Q^3(\mathbb{F})$ below, to stay in agreement despite this apparent problem, processes in a FBQS rely on a transitive reachability property that must hold despite failures.

% We now make two definitions that we use to define Property $Q^3(\mathbb{F})$ below. Define the directed graph $G_\mathbb{F}$ over processes such that there is an edge from $p_i$ to $p_j$ if and only if $p_j\in P_i$. Given a set of processes $S$, a fail-prone set over $S$ is a set of processes obtained by taking the union over all processes in $S$ of one fail-prone set per process. Formally, $T$ is a fail-prone set over $S$ if and only if there exists a family of fail-prone sets $\left\{F_1,...,F_n\right\}$ such that (a), for every $p_i\in S$, $F_i\in \mathcal{F}_i$ and (b) $T=\bigcup_{p_i\in S} F_i$.

% Let $G_\mathbb{F}^*$ be the transitive closure of $G_\mathbb{F}$, i.e. $G_\mathbb{F}^*(p_i)$ is the set of processes reachable from $p_i$ in $G_\mathbb{F}$.

% To define a federated quorum systems for a fail-prone system $\mathbb{F}=\left\{\left(P_1,\mathcal{F}_1\right),...,\left(P_n,\mathcal{F}_n\right)\right\}$, we first need the notion of fail-prone set over a subset $S$ of the processes. Given a set of processes $S$, a fail-prone set over $S$ is a set of processes obtained by taking the union over all processes in $S$ of one fail-prone set per process. Formally, $T$ is a fail-prone set over $S$ if and only if there exists a family of fail-prone sets $\left\{F_1,...,F_n\right\}$ such that (a), for every $p_i\in S$, $F_i\in \mathcal{F}_i$ and (b) $T=\bigcup_{p_i\in S} F_i$.

%Given the above preliminary definitions, we now define property $Q^3(\mathbb{F})$ for federated fail-prone systems.
Next, we define property $Q^3(\mathbb{F})$ for federated fail-prone systems, whose vocation is to be a generalization of the same property for quorum system.
\begin{definition}[Property $Q^3(\mathbb{F})$]
  Property $Q^3(\mathbb{F})$ holds if and only if for every two processes $p_i$ and $p_j$, for every two slice-choice graphs $G_i$ and $G_j$, for every fail-compatible set $A$, there exist a path $x_i$ in $G_i$ and a path $x_j$ in $G_j$ such that:
  \begin{itemize}
    \item $x_i$ starts at $p_i$ and $x_j$ starts at $p_j$,
    \item $x_i$ and $x_j$ intersect, and
    \item both $x_i$ and $x_j$ are disjoint from $A$.
  \end{itemize}
\end{definition}

Informally, Property $Q^3(\mathbb{F})$ captures the essence of the assumptions made by processes in a federated fail-prone system, i.e.\ that two processes can always transitively hear from a third common process despite any failures compatible with the processes' failure assumptions.

% Also note that, having defined Property $Q^3(\mathbb{F})$ as above, fail-prone systems and asymmetric fail-prone systems are a special case of federated fail-prone systems. We will prove this fact in a full version of this paper.

We are now ready to define federated quorum systems for $\mathbb{F}$ and show that there exists a federated quorum system for $\mathbb{F}$ if and only if $Q^3(\mathbb{F})$ holds.

\begin{definition}[Federated Quorum System for $\mathbb{F}$]
  A federated quorum system for $\mathbb{F}$ is an array of quorum systems $\mathbb{Q}=\left[Q_1,...,Q_n\right]$, where $Q_i\subseteq 2^\mathcal{P}$ is a quorum system for $p_i$. Moreover, $\mathbb{Q}$ must satisfy the following two properties.
  \begin{itemize}
    % \item [Closure] If $Q_i$ is a quorum of $p_i$ and $p_j\in Q_i$, then there exists a quorum $Q_j$ of $p_j$ such that $Q_j\subseteq Q_i$.
    \item [Availability] For every slice-choice graph $G$ and for every process $p_i$, the set of processes reachable from $p_i$ in $G$ contains a quorum of $p_i$.
    \item[Consistency] If $Q_i$ is a quorum of $p_i$ and $Q_j$ is a quorum of $p_j$, if $\mathcal{S}_i$ is a slice choice such that $Q_i$ is closed under $\mathcal{S}_i$\todo{why does it need to be closed?}, if $\mathcal{S}_j$ is a slice choice such that $Q_j$ is closed under $\mathcal{S}_j$, and if $A$ is a fail-compatible set, then there is a path $x_i$ in the slice-choice graph $G_i$ corresponding to $\mathcal{S}_i$ and a path $x_j$ in the slice-choice graph $G_j$ corresponding to $\mathcal{S}_j$ such that
      \begin{itemize}
        \item $x_i$ starts at $p_i$ and $x_j$ starts at $p_j$,
        \item $x_i$ consists exclusively of processes in $\left(\{p_i\} \cup Q_i\right)\setminus A$,
        \item $x_j$ consists exclusively of processes in $\left(\{p_j\} \cup Q_j\right)\setminus A$,
        \item $x_i$ and $x_j$ intersect.
      \end{itemize}
  \end{itemize}
\end{definition}

Informally, the Consistency property states that not only must two quorums of two processes $p_i$ and $p_j$ intersect, but some process in the intersection must be reachable, in a peer-to-peer fashion, from both $p_i$ and $p_j$ and despite failures.

\begin{thm}
  \label{thm:existsFQSiff}
  There exists a federated quorum system for $\mathbb{F}$ if and only if $Q^3(\mathbb{F})$ holds.
\end{thm}

To prove~\Cref{thm:existsFQSiff}, we first show in~\Cref{thm:canonical} that for every federated fail-prone system $\mathbb{F}$ satisfying $Q^3(\mathbb{F})$, there exists a canonical quorum system $\overline{\mathbb{F}}$ for $\mathbb{F}$. Second,~\Cref{thm:Q3_must_hold} implies, by contradiction, that if $\mathbb{Q}$ is a federated quorum system for $\mathbb{F}$, then $Q^3(\mathbb{F})$ must hold.

\begin{definition}[Canonical federated quorum system for $\mathbb{F}$]
  \label{def:canonical}
  Given a federated fail-prone system $\mathbb{F}$, we define $\overline{\mathbb{F}}=\left[\mathcal{Q}_1,...,\mathcal{Q}_n\right]$, where the set $\mathcal{Q}_i$ of quorums of $p_i$ is the biggest set such that, for every $Q\in\mathcal{Q}_i$,
  \begin{enumerate}
    \item $p_i$ has a slice that is a subset of $Q$, and
    \item for every process $p_j\in Q$, $p_j$ has a slice that is a subset of $Q$.
  \end{enumerate}
\end{definition}

% Item 2 above warrants some explanation.
% The notion of fail-compatible set is a global notion that cannot possibly be known by a process in a permissionless system.
% So, $\overline{\mathbb{F}}$ does not seem suited for practical use in a permissionless system.
% Surprisingly, as we explain in \Cref{sec:practice}, this is not a problem in practice.
% In practice, a process $p$ determines whether a set $Q$ is an \emph{effective} quorum by checking whether a) $p$ has a slice in $Q$ and b) every member of $Q$ has a slice in $Q$.
% In a fail-compatible execution, $Q$ is guaranteed to be a quorum as in~\Cref{def:canonical} even if failed processes lie about their slices.
% Thus the effective quorums used by the processes satisfies the Consistency property.
% Moreover, given enough communication between processes in a fail-compatible execution, and even if ill-behaved processes lie about their slices, every well-behaved process\todo{define well-behaved} will eventually be able to identify at least one quorum consisting entirely of well-behaved processes.\todo{rework this paragraph}

%Note that if we identify the notion of slice with the notion of quorum slice of Mazi√®res~\cite{MazieresStellarConsensusProtocol2015}, then the definition of quorums above coincides with Mazi√®res' definition; thus a Federated Byzantine Quorum System, as defined by Mazi√®res, is isomorphic to a canonical federated quorum system for some $\mathbb{F}$.

\begin{claim}
  \label{thm:canonical}
 $\overline{\mathbb{F}}$, the canonical federated quorum system for $\mathbb{F}$, satisfies the Availability and Consistency properties.
\end{claim}
\begin{proof}
  $\overline{\mathbb{F}}$ satisfies the Availability Property because, for every process $p_i$ and for every slice-choice graph $G$, the set of processes reachable from $p_i$ is a superset of a quorum by definition of $\overline{\mathbb{F}}$.

  % Moreover, observe that if $Q$ is a quorum of $p_i$ and $p_j\in Q$, then we immediately have, by definition of $\overline{\mathbb{F}}$, that $Q$ is also a quorum of $p_j$; thus $\overline{\mathbb{F}}$ satisfies the Closure Property.

  To show that $\overline{\mathbb{F}}$ satisfies the Consistency property, consider two processes $p_i$ and $p_j$, two quorums $Q_i$ of $p_i$ and $Q_j$ of $p_j$, a slice choice $\mathcal{S}_i$ such that $Q_i$ is closed under $\mathcal{S}_i$, a slice choice $\mathcal{S}_j$ such that $Q_j$ is closed under $\mathcal{S}_j$, and a fail-compatible set $A$. By Property $Q^3(\mathbb{F})$, we immediately obtain a path $x_i$ in the slice-choice graph $G_i$ corresponding to $\mathcal{S}_i$ and a path $x_j$ in the slice-choice graph $G_j$ corresponding to $\mathcal{S}_j$ such that
    \begin{itemize}
      \item $x_i$ starts at $p_i$ and $x_j$ starts at $p_j$,
      \item $x_i$ and $x_j$ intersect, and
      \item both $x_i$ and $x_j$ are disjoint from $A$.
    \end{itemize}
    Thus, to show that $\overline{\mathbb{F}}$ satisfies the Consistency property, it remains to show that $x_i$ consists exclusively of processes in $Q_i$ and $x_j$ consists exclusively of processes in $Q_j$.
    The path $x_i$ consists exclusively of processes in $Q_i$ because $Q_i$ is closed under the slice-choice $\mathcal{S}_i$, and thus no path in $G_i$ that starts in $Q_i$ can exit $Q_i$.
    For an analogous reason, $x_j$ consists exclusively of processes in $Q_j$.
\end{proof}

\begin{claim}
  \label{thm:Q3_must_hold}
  If $\mathbb{Q}$ is a federated quorum system for $\mathbb{F}$ that satisfies the Availability property and $\mathbb{F}$ does not satisfy $Q^3(\mathbb{F})$, then $\mathbb{Q}$ does not satisfy the Consistency property.
\end{claim}
\begin{proof}
  By the assumption that $\mathbb{F}$ does not satisfy $Q^3(\mathbb{F})$, there are two processes $p_i$ and $p_j$, two slice-choice graph $G_i$ and $G_j$, and a fail-compatible set $A$, such that there are no paths $x_i$ in $G_i$ and $x_j$ in $G_j$ such that:
  \begin{enumerate}
    \item $x_i$ starts at $p_i$ and $x_j$ starts at $p_j$,
    \item $x_i$ and $x_j$ intersect, and
    \item both $x_i$ and $x_j$ are disjoint from $A$.
  \end{enumerate}
  Now consider the set of processes $X_i$ reachable in $G_i$ from $p_i$ and the set of processes $X_j$ reachable in $G_j$ from $p_j$. By the availability property, $X_i$ contains a quorum $Q_i$ of $p_i$ and $X_j$ contains a quorum $Q_j$ of $p_j$.
  Now suppose by contradiction that $\mathbb{Q}$ satisfies the Consistency property.
  Then, by definition of Consistency, there is a path $x_i'$ in the slice-choice graph $G_i$ and a path $x_j'$ in the slice-choice graph $G_j$ such that
  \begin{itemize}
    \item $x_i'$ starts at $p_i$ and $x_j$ starts at $p_j$,
    \item $x_i'$ consists exclusively of processes in $\left(\{p_i\} \cup Q_i\right)\setminus A$,
    \item $x_j'$ consists exclusively of processes in $\left(\{p_j\} \cup Q_j\right)\setminus A$,
    \item $x_i'$ and $x_j'$ intersect.
  \end{itemize}
  Then $x_i'$ and $x_j'$ satisfy Items 1, 2 and 3 above, which is a contradiction. Thus $\mathbb{Q}$ does not satisfy the Consistency property.
\end{proof}

Finally, to conclude, Claims 1 and 2 together imply our main result, Theorem 1.

\section{Liars}
\label{sec:lying}

\section{Subjective Failures}
\label{sec:subjective}

\printbibliography

% \section{Related Work}

% Similarly, an asymmetric quorum system is a family of quorum systems $\mathbb{Q}=\left[\mathcal{Q}_1,...,\mathcal{Q}_n\right]$ where $\mathcal{Q}_i$ is the quorum system of process $p_i$. $\mathbb{Q}$ must be such that (a) for every two processes $p_i$ and $p_j$ and for every two quorums $Q_i$ of $p_i$ and $Q_j$ of $p_j$, $Q_i\cap Q_j$ contains a process which is not assumed faulty by both $p_i$ and $p_j$ (i.e. for every $F\in F_i$ and $F'\in F_j$, $Q_i\cap Q_j \not\subseteq F\cap F'$\todo{this is not the wording of Cachin, which seems confusing}), and (b) for every set of processes $F$ that $p_i$ assume may fail together, there is a quorum of $p_i$ that is disjoint from $F$. As in the case of traditional quorum systems, those conditions enable solving useful distributed computing tasks such as read-write registers and broadcast using well-known techniques. Moreover, Cachin and Tackmann show that property $Q^3(\mathcal{F})$ generalizes to asymmetric quorum systems as follows: $Q^3(\mathcal{F})$ holds if and only if for every two processes $p_i$ and $p_j$,



% \begin{center}
% \begin{tabular}{ |c|c| }
  % \hline
  % node & quorums \\
  % \hline
  % $n_1$ & \{  \\
  % \hline
  % $n_2$ & cell5 \\
  % \hline
  % $n_3$ & cell8 \\
  % \hline
  % $n_4$ & cell8 \\
  % \hline
  % $n_5$ & cell8 \\
  % \hline
% \end{tabular}
% \end{center}

\end{document}
